<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>åŸç”ŸJSåˆ›ä½œä¸€ä¸ªå¤šé€‰ä¸€åœºæ™¯äº¤äº’æ¸¸æˆ</title>
    <link rel="stylesheet" href="../css/Day163-index.css" />
  </head>
  <body>
    <!-- å¤šé€‰ä¸€çš„åœºæ™¯æ˜¯å¾ˆå¸¸è§çš„ï¼Œæµè§ˆå™¨è‡ªå¸¦çš„<input type="radio">æ§ä»¶å°±é€‚ç”¨è¿™æ ·çš„åœºæ™¯ã€‚æœ¬é¡¹ç›®å°†è®¾è®¡ä¸€ä¸ªå¤šé€‰ä¸€çš„äº¤äº’åœºæ™¯ï¼Œç”¨cssè¿›è¡Œé¡µé¢å¸ƒå±€ã€ç”¨gaspåˆ¶ä½œåŠ¨ç”»æ•ˆæœã€ç”¨åŸç”Ÿjsç¼–å†™ç¨‹åºé€»è¾‘ã€‚
  è¿™ä¸ªæ¸¸æˆçš„é€»è¾‘å¾ˆç®€å•ï¼Œåœ¨é¡µé¢ä¸Šéƒ¨å±•ç¤ºå‡ºä¸€ä¸ªåŠ¨ç‰©çš„å…¨èº«åƒï¼Œè¯·ç”¨æˆ·åœ¨ä¸‹é¢çš„å°å›¾ç‰‡ä¸­é€‰æ‹©è¿™ä¸ªåŠ¨ç‰©å¯¹åº”çš„å¤´åƒï¼Œå¦‚æœé€‰å¯¹äº†ï¼Œå°±å¯å†ç©ä¸€æ¬¡ã€‚
  æ•´ä¸ªæ¸¸æˆåˆ†ä¸º3ä¸ªæ­¥éª¤å¼€å‘ï¼šé™æ€çš„é¡µé¢å¸ƒå±€ã€ç¨‹åºé€»è¾‘å’ŒåŠ¨ç”»æ•ˆæœã€‚ -->
    <div class="app">
      <h1>Which face is the animal's?</h1>
      <div class="whole-body">ğŸ„</div>
      <div class="bingo">
        Bingo!
        <span class="again">Play Again</span>
      </div>
      <div class="selector">
        <span class="slider"></span>
        <span class="face">ğŸ­</span>
        <span class="face">ğŸ¶</span>
        <span class="face">ğŸ·</span>
        <span class="face">ğŸ®</span>
        <span class="face">ğŸ¯</span>
      </div>
    </div>
  </body>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.11/lodash.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/2.0.2/TweenMax.min.js"></script>
  <script>
    const animals = {
      "ğŸ­": "ğŸ",
      "ğŸ¶": "ğŸ•",
      "ğŸ·": "ğŸ–",
      "ğŸ®": "ğŸ„",
      "ğŸ¯": "ğŸ…",
      "ğŸ”": "ğŸ“",
      "ğŸµ": "ğŸ’",
      "ğŸ²": "ğŸ‰",
      "ğŸ´": "ğŸ",
      "ğŸ°": "ğŸ‡",
    }

    const doms = {
      wholeBody: document.querySelector(".whole-body"),
      bingo: document.querySelector(".bingo"),
      again: document.querySelector(".again"),
      faces: [...document.querySelectorAll(".face")],
      slider: document.querySelector(".slider"),
    }

    const animation = {
      frameOut: () => {
        return new Promise((resolve) => {
          new TimelineMax()
            .to(doms.bingo, 0, { visibility: "hidden" })
            .to(doms.slider, 1, { scale: 0 }, "t1")
            .staggerTo(doms.faces, 1, { scale: 0 }, 0.25, "t1")
            .to(doms.wholeBody, 1, { scale: 0 }, "t1")
            .timeScale(5)
            .eventCallback("onComplete", resolve)
        })
      },
      frameIn: () => {
        return new Promise((resolve) => {
          new TimelineMax()
            .to(doms.slider, 0, { left: "0px" })
            .to(doms.wholeBody, 2, { scale: 1, delay: 1 })
            .staggerTo(doms.faces, 1, { scale: 1 }, 0.25)
            .to(doms.slider, 1, { scale: 1 })
            .timeScale(5)
            .eventCallback("onComplete", resolve)
        })
      },
      moveSlider: (position) => {
        return new Promise((resolve) => {
          new TimelineMax()
            .to(doms.slider, 1, { scale: 0.3 })
            .to(doms.slider, 1, { left: (25 + 60) * position + "px" })
            .to(doms.slider, 1, { scale: 1 })
            .timeScale(5)
            .eventCallback("onComplete", resolve)
        })
      },
      showBingo: () => {
        return new Promise((resolve) => {
          new TimelineMax()
            .to(doms.bingo, 0, { visibility: "visible" })
            .to(doms.bingo, 1, { rotation: -5 })
            .to(doms.bingo, 1, { rotation: 5 })
            .to(doms.bingo, 1, { rotation: 0 })
            .timeScale(8)
            .eventCallback("onComplete", resolve)
        })
      },
    }

    let options = []
    let answer = {}
    let canSelect = false

    const shuffle = () => {
      options = _.slice(_.shuffle(_.entries(animals)), -5)
      answer = _.sample(_.slice(options, -4))

      doms.faces.forEach((face, i) => {
        face.innerText = options[i][0]
      })
      doms.wholeBody.innerText = answer[1]
    }

    const newGame = () => {
      animation.frameOut()
      shuffle()
      animation.frameIn()
      canSelect = true
    }

    const select = async (e) => {
      if (!canSelect) return

      let position = _.findIndex(options, (o) => o[0] === e.target.innerText)
      await animation.moveSlider(position)

      if (animals[e.target.innerText] === answer[1]) {
        canSelect = false
        await animation.showBingo()
      }
    }

    const init = () => {
      doms.faces.forEach((element) => {
        element.addEventListener("click", select)
      })

      doms.again.addEventListener("click", newGame)
      newGame()
    }

    window.onload = init
  </script>
</html>
